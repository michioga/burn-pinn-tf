# 音叉PINN: Burnで作る物理情報ニューラルネットワーク

このプロジェクトは、Rustのディープラーニングフレームワーク [Burn](https://burn.dev/) を使用して、**物理情報ニューラルネットワーク (Physics-Informed Neural Network, PINN)** を実装するデモンストレーションです。

目標の周波数を入力すると、その周波数を実現するための音叉の物理的な寸法をニューラルネットワークが予測します。

## 概要

通常のニューラルネットワークは、大量の「入力と正解出力のペア」データセットから学習します。しかし、多くの物理現象では、このようなデータセットを大量に用意するのは困難です。

PINNは、物理現象を支配する**物理法則（偏微分方程式など）を損失関数に直接組み込む**ことで、この問題を解決します。モデルの出力が物理法則を満たさない場合にペナルティ（損失）を与えることで、少量のデータ、あるいはデータなしでも、物理的に妥当な解を学習させることができます。

このプロジェクトでは、「音叉の寸法と周波数の関係式」を物理法則として利用します。

## 物理モデル

音叉のプロング（振動する腕）の基本周波 $f$ は、以下の簡易式でモデル化されます。この式が損失関数の中核を担います。

$
f = \frac{K}{L^2} \sqrt{\frac{E \cdot I}{\rho \cdot A}}
$

| 変数 | 説明 | 対応する定数/変数 |
| :--- | :--- | :--- |
| $f$ | 周波数 (Hz) | `target_freqs` |
| $K$ | 経験的な係数 | `FREQ_K_CONSTANT` |
| $L$ | プロングの長さ (m) | `prong_length` |
| $E$ | ヤング率 (Pa) | `YOUNGS_MODULUS` |
| $I$ | 断面二次モーメント | `moment_of_inertia` |
| $\rho$ | 密度 (kg/m³) | `DENSITY` |
| $A$ | 断面積 (m²) | `area` |

さらに、解が物理的に意味を持つように、以下のペナルティ項を損失に加えています。
- **比率ペナルティ**: 「プロングの長さは、柄の長さより短くてはならない」という制約。
- **範囲ペナルティ**: 「プロングの直径は、2mmから20mmの範囲でなければならない」という制約。

## アーキテクチャ

- **モデル**: シンプルな3層の多層パーセプトロン (MLP) です。
- **フレームワーク**: `burn` を使用しています。
- **バックエンド**: `ndarray` (CPU) と `wgpu` (GPU) の両方をサポートしており、コマンドライン引数で切り替え可能です。
- **学習**: `burn`の`Learner` APIを活用し、学習ループ、メトリクス記録、モデル保存を効率的に行っています。

## セットアップ

Rustの環境がセットアップされている必要があります。

1.  リポジトリをクローンします。
    ```bash
    git clone https://github.com/user/burn-tuningfork-pinn.git
    cd burn-tuningfork-pinn
    ```
2.  依存関係をビルドします。
    ```bash
    cargo build --release
    ```

## 使用方法

### 1. 学習

以下のコマンドでモデルの学習を開始します。`--backend`フラグを使用して、`ndarray`（CPU）または`wgpu`（GPU）を選択できます。学習済みモデルは `artifacts/` ディレクトリに保存されます。

- **`wgpu` バックエンドで学習 (デフォルト):**
  ```bash
  cargo run --release -- train --backend wgpu
  ```

- **`ndarray` バックエンドで学習:**
  ```bash
  cargo run --release -- train --backend ndarray
  ```

### 2. 推論

学習済みモデルを使い、指定した周波数に対する音叉の寸法を推論します。

- **例: 440Hz (A4) の音叉の寸法を `wgpu` で推論**
  ```bash
  cargo run --release -- infer --freq 440 --backend wgpu
  ```

- **例: 262Hz (C4) の音叉の寸法を `ndarray` で推論**
  ```bash
  cargo run --release -- infer --freq 262 --backend ndarray
  ```

## ソースコード構成

- `main.rs`: エントリーポイント。コマンドライン引数を解析し、バックエンドを選択します。
- `model.rs`: ニューラルネットワークの構造を定義します。
- `physics.rs`: 物理法則に基づいた損失関数を定義します。
- `constants.rs`: 物理計算で使用する定数を定義します。
- `train.rs`: `Learner` APIを使ったジェネリックな学習ロジックです。
- `infer.rs`: 学習済みモデルを使ったジェネリックな推論ロジックです。

## ドキュメント生成

以下のコマンドで、ソースコード内のコメントからHTML形式のドキュメントを生成し、ブラウザで開くことができます。

```bash
cargo doc --open
```
