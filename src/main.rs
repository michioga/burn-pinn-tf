//! # éŸ³å‰ã®ç‰©ç†æƒ…å ±ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (PINN)
//!
//! ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€[Burn](https://burn.dev/)ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€
//! ç‰©ç†æƒ…å ±ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆPINNï¼‰ã‚’å®Ÿè£…ã™ã‚‹ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
//!
//! å…·ä½“çš„ã«ã¯ã€éŸ³å‰ã®ç›®æ¨™å‘¨æ³¢æ•°ï¼ˆä¾‹: 440Hzï¼‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€
//! ãã®å‘¨æ³¢æ•°ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ç‰©ç†çš„ãªå¯¸æ³•ï¼ˆæŸ„ã®é•·ã•ã€ãƒ—ãƒ­ãƒ³ã‚°ã®é•·ã•ãªã©ï¼‰ã‚’
//! ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå‡ºåŠ›ã—ã¾ã™ã€‚
//!
//! å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€ç‰©ç†æ³•å‰‡ã‚’æå¤±é–¢æ•°ã«çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€
//! ãƒ¢ãƒ‡ãƒ«ãŒç‰©ç†çš„ã«å¦¥å½“ãªè§£ã‚’å­¦ç¿’ã™ã‚‹ã‚ˆã†ã«èª˜å°ã—ã¾ã™ã€‚
//!
//! ## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
//!
//! ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯CPUã§å‹•ä½œã™ã‚‹`ndarray`ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

#![recursion_limit = "256"]

use clap::{Parser, Subcommand};

mod constants;
mod infer;
mod model;
mod physics;
mod train;

/// ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®šç¾©
#[derive(Parser, Debug)]
#[command(author, version, about, long_about = None)]
struct Cli {
    #[command(subcommand)]
    command: Commands,
}

/// ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ (`train` ã¾ãŸã¯ `infer`)
#[derive(Subcommand, Debug)]
enum Commands {
    /// ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã•ã›ã¾ã™ã€‚
    Train,
    /// å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦æ¨è«–ã—ã¾ã™ã€‚
    Infer {
        /// æ¨è«–ã—ãŸã„éŸ³å‰ã®å‘¨æ³¢æ•° (Hz)
        #[arg(short, long)]
        freq: f32,
    },
}

/// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
fn main() {
    let cli = Cli::parse();

    match cli.command {
        Commands::Train => {
            println!("ğŸš€ Starting training...");
            train::run();
        }
        Commands::Infer { freq } => {
            println!("ğŸ” Inferring for frequency: {} Hz", freq);
            infer::run(freq);
        }
    }
}
